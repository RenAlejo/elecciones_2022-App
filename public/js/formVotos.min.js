const url=window.location.hostname.includes("localhost")?"http://localhost:8181/api/":"https://votaciones2022.herokuapp.com/api/";let token=localStorage.getItem("token")||"";if(token.length<=10)throw window.location="/",new Error("El token no es vÃ¡lido");let formJurado={e11:0,votosUrna:0,votosIncinerados:0},formReg={rh:0,gp:0,votoblanco:0,votonulo:0,votonomarcado:0,totalVotos:0},formMesa={totalVotosMesa:0},userInfo=null;const validateJWT=async()=>{try{const o=await fetch(url+"auth",{headers:{Authorization:token}}),{user:e,token:t}=await o.json();localStorage.setItem("token",t),userInfo=e,token=t}catch(o){window.location="/",console.log(o)}},main=async()=>{await validateJWT()},getDepartamentos=async()=>{const o=await fetch(url+"departamentos",{headers:{Authorization:token}}),{...e}=await o.json(),t=document.querySelector("#departamentosSelect");for(let o in e.departamentos){let a=document.createElement("option");a.value=e.departamentos[o].cod_dep,a.text=e.departamentos[o].departamento,t.add(a)}""!=e.user.departamento&&""!=e.user.municipio&&(t.value=e.user.departamento,getMunicipios(e.user.departamento,e.user.municipio))},clearSelect=o=>{for(let e=o.options.length;e>=0;e--)o.remove(e)},getMunicipios=async(o,...e)=>{const t=await fetch(url+`municipios/${o}`,{headers:{Authorization:token}}),{...a}=await t.json(),n=document.querySelector("#municipiosSelect");n.disabled=!1,clearSelect(n),0===parseInt(o)&&(n.disabled=!0);for(let o in a.municipios){let e=document.createElement("option");e.value=a.municipios[o].codigo_mun,e.text=a.municipios[o].municipio,n.add(e)}e.length>0&&(n.value=e[0])},getTipologias=async()=>{const o=await fetch(url+"tipologia",{headers:{Authorization:token}}),{...e}=await o.json(),t=document.querySelector("#tipologiasSelect");for(let o in e.tipologias){let a=document.createElement("option");a.value=e.tipologias[o].codigo_tipologia,a.text=e.tipologias[o].desc_tipologia,t.add(a)}},sumJurado=o=>{e11="e11"==o.desc?formJurado.e11=o.value:0,votosUrna="votosurna"==o.desc?formJurado.votosUrna=o.value:0,votosIncinerados="votosincinerados"==o.desc?formJurado.votosIncinerados=o.value:0;let e=0;if(0!=formJurado.e11&&parseInt(formJurado.votosUrna)+parseInt(formJurado.votosIncinerados)!=0){let o=document.getElementById("juradodiferencia");e=parseInt(formJurado.votosUrna)+parseInt(formJurado.votosIncinerados)-parseInt(formJurado.e11),e<0?(e*=-1,o.classList.remove("btn-success"),o.classList.add("btn-danger"),document.getElementById("total").innerHTML=e):0!=e?(o.classList.remove("btn-success"),o.classList.add("btn-danger"),document.getElementById("total").innerHTML=e):(o.classList.remove("btn-danger"),o.classList.add("btn-success"),document.getElementById("total").innerHTML=0)}},sumReg=o=>{rh="rh"==o.desc?formReg.rh=o.value:0,gp="gp"==o.desc?formReg.gp=o.value:0,votoblanco="votoblanco"==o.desc?formReg.votoblanco=o.value:0,votonulo="votonulo"==o.desc?formReg.votonulo=o.value:0,votonomarcado="votonomarcado"==o.desc?formReg.votonomarcado=o.value:0;var e=0;e=document.getElementById("totalVotosReg").innerHTML,e=null==e||null==e||""==e?0:e,e=parseInt(formReg.rh)+parseInt(formReg.gp)+parseInt(formReg.votoblanco)+parseInt(formReg.votonulo)+parseInt(formReg.votonomarcado),formReg.totalVotos=e,document.getElementById("totalVotosReg").innerHTML=e,0!=parseInt(formMesa.totalVotosMesa)&&sumMesa(parseInt(formMesa.totalVotosMesa))},sumMesa=o=>{let e=0;formMesa.totalVotosMesa=o,e=parseInt(formReg.totalVotos)-parseInt(o);let t=document.getElementById("mesadiferencia"),a=document.getElementById("diferenciaVotosMesa");e<0?(e*=-1,t.classList.remove("btn-success"),t.classList.add("btn-danger"),a.innerHTML=e):0!=e?(t.classList.remove("btn-success"),t.classList.add("btn-danger"),a.innerHTML=e):(t.classList.remove("btn-danger"),t.classList.add("btn-success"),a.innerHTML=0)};main(),getDepartamentos(),getTipologias();