const url=window.location.hostname.includes("localhost")?"http://localhost:8181/api/":"https://votaciones2022.herokuapp.com/api/",path=location.href.split("/");let token=localStorage.getItem("token")||"",formJurado={e11:0,votosUrna:0,votosIncinerados:0},formReg={rh:0,gp:0,votoblanco:0,votonulo:0,votonomarcado:0,totalVotos:0},formMesa={totalVotosMesa:0},userInfo=null;const getDepartamentos=async()=>{const e=await fetch(url+"departamentos",{headers:{Authorization:token}}),{...o}=await e.json(),t=document.querySelector("#departamentosSelect");for(let e in o.departamentos){let a=document.createElement("option");a.value=o.departamentos[e].cod_dep,a.text=o.departamentos[e].departamento,t.add(a)}""!=o.user.departamento&&""!=o.user.municipio&&"edit.html"!==path[path.length-1]&&(t.value=o.user.departamento,getMunicipios(o.user.departamento,o.user.municipio))},clearSelect=e=>{for(let o=e.options.length;o>=0;o--)e.remove(o)},getMunicipios=async(e,...o)=>{const t=await fetch(url+`municipios/${e}`,{headers:{Authorization:token}}),{...a}=await t.json(),n=document.querySelector("#municipiosSelect");n.disabled=!1,clearSelect(n),0===parseInt(e)&&(n.disabled=!0);for(let e in a.municipios){let o=document.createElement("option");o.value=a.municipios[e].codigo_mun,o.text=a.municipios[e].municipio,n.add(o)}o.length>0&&(n.value=o[0])},getTipologias=async()=>{const e=await fetch(url+"tipologia",{headers:{Authorization:token}}),{...o}=await e.json(),t=document.querySelector("#tipologiasSelect");let a=document.createElement("option");a.value=0,a.text=" - ",t.add(a);for(let e in o.tipologias){let a=document.createElement("option");a.value=o.tipologias[e].codigo_tipologia,a.text=o.tipologias[e].desc_tipologia,t.add(a)}},sumJurado=e=>{e11="e11"==e.desc?formJurado.e11=e.value:0,votosUrna="votosurna"==e.desc?formJurado.votosUrna=e.value:0,votosIncinerados="votosincinerados"==e.desc?formJurado.votosIncinerados=e.value:0;let o=0;if(0!=formJurado.e11&&parseInt(formJurado.votosUrna)-parseInt(formJurado.votosIncinerados)!=0){let e=document.getElementById("juradodiferencia");o=parseInt(formJurado.votosUrna)-parseInt(formJurado.votosIncinerados)-parseInt(formJurado.e11),o<0?(o*=-1,e.classList.remove("btn-success"),e.classList.add("btn-danger"),document.getElementById("total").innerHTML=o):0!=o?(e.classList.remove("btn-success"),e.classList.add("btn-danger"),document.getElementById("total").innerHTML=o):(e.classList.remove("btn-danger"),e.classList.add("btn-success"),document.getElementById("total").innerHTML=0)}},sumReg=e=>{rh="rh"==e.desc?formReg.rh=e.value:0,gp="gp"==e.desc?formReg.gp=e.value:0,votoblanco="votoblanco"==e.desc?formReg.votoblanco=e.value:0,votonulo="votonulo"==e.desc?formReg.votonulo=e.value:0,votonomarcado="votonomarcado"==e.desc?formReg.votonomarcado=e.value:0;var o=0;o=document.getElementById("totalVotosReg").innerHTML,o=null==o||null==o||""==o?0:o,o=parseInt(formReg.rh)+parseInt(formReg.gp)+parseInt(formReg.votoblanco)+parseInt(formReg.votonulo)+parseInt(formReg.votonomarcado),formReg.totalVotos=o,document.getElementById("totalVotosReg").innerHTML=o,0!=parseInt(formMesa.totalVotosMesa)&&sumMesa(parseInt(formMesa.totalVotosMesa))},sumMesa=e=>{let o=0;formMesa.totalVotosMesa=e,o=parseInt(formReg.totalVotos)-parseInt(e);let t=document.getElementById("mesadiferencia"),a=document.getElementById("diferenciaVotosMesa");o<0?(o*=-1,t.classList.remove("btn-success"),t.classList.add("btn-danger"),a.innerHTML=o):0!=o?(t.classList.remove("btn-success"),t.classList.add("btn-danger"),a.innerHTML=o):(t.classList.remove("btn-danger"),t.classList.add("btn-success"),a.innerHTML=0)};getDepartamentos(),getTipologias();