const api=window.location.hostname.includes("localhost")?"http://localhost:8181/api/":"https://votaciones2022.herokuapp.com/api/";let tk=localStorage.getItem("token")||"";if(tk.length<=10||""==tk)throw window.location="/views/logout.html",new Error("El token no es válido");let form={};const validateJWT=async()=>{try{const e=location.href.split("/"),t=await fetch(api+"auth",{headers:{Authorization:tk}}),{user:o,token:n}=await t.json();if(localStorage.setItem("token",n),userInfo=o,tk=n,"edit.html"==e[e.length-1]&&"user"===userInfo.rol&&(window.location="/"),"administrator"===userInfo.rol){const t=document.querySelector("#menu"),o=document.createElement("li"),n=document.createElement("a"),r=document.createElement("i"),i=document.createElement("span");"edit.html"==e[e.length-1]?o.className="sidebar-item active":o.className="sidebar-item",n.href="/views/edit.html",n.className="sidebar-link",o.appendChild(n),r.className="bi bi-pen-fill",n.appendChild(r),i.innerHTML="Editar Registros",n.appendChild(i),t.appendChild(o)}}catch(e){console.log(e),window.location="/"}},main=async()=>{await validateJWT()},editEntry=e=>{const t=e.parentNode.parentNode.childNodes;for(let e of t){let t=e.id;if("accion"!=t){form[`${t}`]=e.innerHTML;let o=form[`${t}`];e.innerHTML=`<input style="width: 90px" value="${o}" type="number" required pattern="^[0-9]" min="0" max="20000" maxlength="5" oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" id="${t}" class="form-control" name="${t}">`}"accion"==t&&(e.innerHTML='<button id="editar" onClick="saveEntry(this)" class="bi bi-check2-square" style="padding: 2px; background: none; border: 0; color:green; cursor: pointer; with: 150px" alt="guardar" value="enviar"></button>\n            <button id="editar" onClick="restoreEntry(this,true)" class="bi bi-x-lg" style="padding: 2px; background: none; border: 0; color:red; cursor: pointer; with: 150px; margin-left:10px" alt="guardar" value="enviar"></button>')}},saveEntry=async e=>{const t=e.parentNode.parentNode.childNodes;let o={};for(let e of t){let t=e.id;null!=e.childNodes[0]&&"accion"!=t&&(o[`${t}`]=e.childNodes[0].value)}fetch(url+`votos/${o.id}`,{method:"PUT",body:JSON.stringify(o),headers:{Authorization:token,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(e.errors){for(let t in e.errors)alert(`${e.errors[t].msg}`);return console.error(e)}alert("Se actualizó el registro")}).catch(e=>{console.log(e)}),restoreEntry(e)},deleteEntry=async e=>{const t=e.parentNode.parentNode.childNodes,o=e.parentNode.parentNode;let n=confirm("El registro se eliminará, presione Ok para continuar"),r={};if(n){for(let e of t)"id"==e.id&&(r.id=e.childNodes[0].data);fetch(url+`votos/${r.id}`,{method:"DELETE",headers:{Authorization:token}}).then(e=>e.json()).then(e=>{if(e.errors){for(let t in e.errors)alert(`${e.errors[t].msg}`);return console.error(e)}o.remove(),alert("Registro eliminado correctamente")}).catch(e=>{console.log(e)})}},restoreEntry=(e,...t)=>{const o=e.parentNode.parentNode.childNodes;let n={};for(let e of o){let o=e.id;!0===t[0]?e.innerHTML=form[`${o}`]:null!=e.childNodes[0]&&"accion"!=o&&(n[`${o}`]=e.childNodes[0].value,e.innerHTML=n[`${o}`]),"accion"==o&&(e.innerHTML='<button id="editar" onClick="editEntry(this)" class="bi bi-pencil" style="padding: 2px; background: none; border: 0; color:green; cursor: pointer;" alt="editar" value="enviar"></button>\n            <button id="borrar" onClick="deleteEntry(this)" class="bi bi-trash" style="padding: 2px; margin-left: 10px; background: none; border: 0; color:brown; cursor: pointer;" alt="editar"></button>')}};main();